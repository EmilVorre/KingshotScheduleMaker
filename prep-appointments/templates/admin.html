<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Appointment Scheduler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s, transform 0.3s; }
        .fade-enter-from { opacity: 0; transform: translateY(-10px); }
        .fade-leave-to { opacity: 0; transform: translateY(-10px); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="app">
        <div class="container mx-auto px-4 py-8">
            <header class="text-center mb-12">
                <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">
                    <i class="fas fa-shield-alt mr-3"></i>Admin Panel
                </h1>
                <p class="text-xl text-white/90 font-light">Upload CSV and Generate Schedules</p>
            </header>
            
            <nav class="flex justify-center gap-4 mb-12 flex-wrap">
                <a href="/" class="px-6 py-3 glass-effect text-white rounded-lg font-medium hover:bg-white/20 transition-all">
                    <i class="fas fa-home mr-2"></i>Home
                </a>
                <a href="/schedules" class="px-6 py-3 glass-effect text-white rounded-lg font-medium hover:bg-white/20 transition-all">
                    <i class="fas fa-calendar-check mr-2"></i>Schedules
                </a>
                <a href="/stats" class="px-6 py-3 glass-effect text-white rounded-lg font-medium hover:bg-white/20 transition-all">
                    <i class="fas fa-chart-bar mr-2"></i>Statistics
                </a>
                <a href="/admin" class="px-6 py-3 glass-effect text-white rounded-lg font-medium hover:bg-white/20 transition-all bg-white/20">
                    <i class="fas fa-shield-alt mr-2"></i>Admin
                </a>
            </nav>
            
            <main class="max-w-2xl mx-auto">
                <div class="bg-white rounded-2xl shadow-2xl p-8">
                    <transition name="fade" mode="out-in">
                        <div v-if="!isAuthenticated" key="login">
                            <div class="text-center mb-8">
                                <div class="inline-block bg-red-100 rounded-full p-4 mb-4">
                                    <i class="fas fa-lock text-red-600 text-3xl"></i>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Login Required</h2>
                                <p class="text-gray-600">Enter your admin password to access the upload panel</p>
                            </div>
                            <form @submit.prevent="handleLogin" class="space-y-6">
                                <div>
                                    <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-key mr-2"></i>Password
                                    </label>
                                    <input 
                                        type="password" 
                                        id="password" 
                                        v-model="password"
                                        required
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition-all"
                                        :class="{'border-red-500': loginError}">
                                </div>
                                <button 
                                    type="submit" 
                                    :disabled="loggingIn"
                                    class="w-full bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i v-if="!loggingIn" class="fas fa-sign-in-alt mr-2"></i>
                                    <i v-else class="fas fa-spinner fa-spin mr-2"></i>
                                    {{ loggingIn ? 'Logging in...' : 'Login' }}
                                </button>
                            </form>
                            <transition name="fade">
                                <div v-if="loginError" class="mt-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded">
                                    <i class="fas fa-exclamation-circle mr-2"></i>{{ loginError }}
                                </div>
                            </transition>
                        </div>
                        
                        <div v-else key="admin">
                            <div class="text-center mb-8">
                                <div class="inline-block bg-green-100 rounded-full p-4 mb-4">
                                    <i class="fas fa-upload text-green-600 text-3xl"></i>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Upload CSV File</h2>
                                <p class="text-gray-600">Select a CSV file to process and generate schedules</p>
                            </div>
                            <form @submit.prevent="handleUpload" class="space-y-6">
                                <div>
                                    <label for="csv-file" class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-file-csv mr-2"></i>Select CSV File
                                    </label>
                                    <div class="relative">
                                        <input 
                                            type="file" 
                                            id="csv-file" 
                                            @change="handleFileSelect"
                                            accept=".csv" 
                                            required
                                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                                    </div>
                                    <p v-if="selectedFile" class="mt-2 text-sm text-gray-600">
                                        <i class="fas fa-file mr-2"></i>Selected: {{ selectedFile.name }}
                                    </p>
                                </div>
                                <button 
                                    type="submit" 
                                    :disabled="uploading || !selectedFile"
                                    class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i v-if="!uploading" class="fas fa-cloud-upload-alt mr-2"></i>
                                    <i v-else class="fas fa-spinner fa-spin mr-2"></i>
                                    {{ uploading ? 'Uploading and processing...' : 'Upload & Generate Schedule' }}
                                </button>
                            </form>
                            <transition name="fade">
                                <div v-if="uploadStatus" 
                                     :class="[
                                         'mt-4 p-4 rounded-lg',
                                         uploadStatus.type === 'success' ? 'bg-green-50 border-l-4 border-green-500 text-green-700' : 'bg-red-50 border-l-4 border-red-500 text-red-700'
                                     ]">
                                    <i :class="uploadStatus.type === 'success' ? 'fas fa-check-circle' : 'fas fa-times-circle' + ' mr-2'"></i>
                                    {{ uploadStatus.message }}
                                </div>
                            </transition>
                        </div>
                    </transition>
                </div>
            </main>
            
            <footer class="text-center mt-12 text-white/80">
                <p>&copy; 2025 SvS Preparation Week Scheduler</p>
            </footer>
        </div>
    </div>
    
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    isAuthenticated: false,
                    password: '',
                    adminPassword: '',
                    loggingIn: false,
                    loginError: null,
                    selectedFile: null,
                    uploading: false,
                    uploadStatus: null
                }
            },
            methods: {
                async handleLogin() {
                    this.loggingIn = true;
                    this.loginError = null;
                    
                    try {
                        const response = await fetch('/api/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ password: this.password })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.adminPassword = this.password;
                            this.isAuthenticated = true;
                            this.password = '';
                        } else {
                            this.loginError = data.error || 'Invalid password';
                        }
                    } catch (error) {
                        this.loginError = 'Error: ' + error.message;
                    } finally {
                        this.loggingIn = false;
                    }
                },
                handleFileSelect(event) {
                    this.selectedFile = event.target.files[0];
                    this.uploadStatus = null;
                },
                async handleUpload() {
                    if (!this.selectedFile) {
                        this.uploadStatus = { type: 'error', message: 'Please select a file' };
                        return;
                    }
                    
                    this.uploading = true;
                    this.uploadStatus = null;
                    
                    try {
                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            headers: { 'X-Admin-Password': this.adminPassword },
                            body: this.selectedFile
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.uploadStatus = {
                                type: 'success',
                                message: data.message || 'Schedule generated successfully!'
                            };
                            this.selectedFile = null;
                            document.getElementById('csv-file').value = '';
                        } else {
                            this.uploadStatus = {
                                type: 'error',
                                message: 'Error: ' + (data.error || 'Upload failed')
                            };
                        }
                    } catch (error) {
                        this.uploadStatus = {
                            type: 'error',
                            message: 'Error: ' + error.message
                        };
                    } finally {
                        this.uploading = false;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
